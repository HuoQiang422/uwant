import{k as R,r as s,C as I,o as W,q as U,s as L,v as M,B as w,w as X,x as J,P as G,y as A,z as Q,D as Y,F as Z,G as ee,j as r,c as $,S as F,H as te,M as ne,e as E,p as O,l as j,J as ae,K as oe,L as se,N as le,O as re,Q as ie,i as N,U as ce}from"./index-y6A3uTe8.js";import{K as de,B as me,u as ue,T as pe,M as fe,a as ge}from"./useFresh-sfUNA2el.js";const xe=e=>{const{componentCls:n,iconCls:o,antCls:t,zIndexPopup:a,colorText:f,colorWarning:p,marginXXS:i,marginXS:m,fontSize:d,fontWeightStrong:u,colorTextHeading:y}=e;return{[n]:{zIndex:a,[`&${t}-popover`]:{fontSize:d},[`${n}-message`]:{marginBottom:m,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${n}-message-icon ${o}`]:{color:p,fontSize:d,lineHeight:1,marginInlineEnd:m},[`${n}-title`]:{fontWeight:u,color:y,"&:only-child":{fontWeight:"normal"}},[`${n}-description`]:{marginTop:i,color:f}},[`${n}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:m}}}}},ye=e=>{const{zIndexPopupBase:n}=e;return{zIndexPopup:n+60}},z=R("Popconfirm",e=>xe(e),ye,{resetStyle:!1});var he=function(e,n){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(e);a<t.length;a++)n.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(e,t[a])&&(o[t[a]]=e[t[a]]);return o};const B=e=>{const{prefixCls:n,okButtonProps:o,cancelButtonProps:t,title:a,description:f,cancelText:p,okText:i,okType:m="primary",icon:d=s.createElement(A,null),showCancel:u=!0,close:y,onConfirm:P,onCancel:v,onPopupClick:S}=e,{getPrefixCls:T}=s.useContext(I),[h]=W("Popconfirm",U.Popconfirm),C=L(a),l=L(f);return s.createElement("div",{className:`${n}-inner-content`,onClick:S},s.createElement("div",{className:`${n}-message`},d&&s.createElement("span",{className:`${n}-message-icon`},d),s.createElement("div",{className:`${n}-message-text`},C&&s.createElement("div",{className:M(`${n}-title`)},C),l&&s.createElement("div",{className:`${n}-description`},l))),s.createElement("div",{className:`${n}-buttons`},u&&s.createElement(w,Object.assign({onClick:v,size:"small"},t),p||(h==null?void 0:h.cancelText)),s.createElement(X,{buttonProps:Object.assign(Object.assign({size:"small"},J(m)),o),actionFn:P,close:y,prefixCls:T("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},i||(h==null?void 0:h.okText))))},Ce=e=>{const{prefixCls:n,placement:o,className:t,style:a}=e,f=he(e,["prefixCls","placement","className","style"]),{getPrefixCls:p}=s.useContext(I),i=p("popconfirm",n),[m]=z(i);return m(s.createElement(G,{placement:o,className:M(i,t),style:a,content:s.createElement(B,Object.assign({prefixCls:i},f))}))},Pe=Ce;var ve=function(e,n){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(e);a<t.length;a++)n.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(e,t[a])&&(o[t[a]]=e[t[a]]);return o};const D=s.forwardRef((e,n)=>{var o,t;const{prefixCls:a,placement:f="top",trigger:p="click",okType:i="primary",icon:m=s.createElement(A,null),children:d,overlayClassName:u,onOpenChange:y,onVisibleChange:P}=e,v=ve(e,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange"]),{getPrefixCls:S}=s.useContext(I),[T,h]=Q(!1,{value:(o=e.open)!==null&&o!==void 0?o:e.visible,defaultValue:(t=e.defaultOpen)!==null&&t!==void 0?t:e.defaultVisible}),C=(c,x)=>{h(c,!0),P==null||P(c),y==null||y(c,x)},l=c=>{C(!1,c)},g=c=>{var x;return(x=e.onConfirm)===null||x===void 0?void 0:x.call(void 0,c)},b=c=>{var x;C(!1,c),(x=e.onCancel)===null||x===void 0||x.call(void 0,c)},V=c=>{c.keyCode===de.ESC&&T&&C(!1,c)},K=c=>{const{disabled:x=!1}=e;x||C(c)},k=S("popconfirm",a),q=M(k,u),[H]=z(k);return H(s.createElement(Y,Object.assign({},Z(v,["title"]),{trigger:p,placement:f,onOpenChange:K,open:T,ref:n,overlayClassName:q,content:s.createElement(B,Object.assign({okType:i,icon:m},e,{prefixCls:k,close:l,onConfirm:g,onCancel:b})),"data-popover-inject":!0}),ee(d,{onKeyDown:c=>{var x,_;s.isValidElement(d)&&((_=d==null?void 0:(x=d.props).onKeyDown)===null||_===void 0||_.call(x,c)),V(c)}})))});D._InternalPanelDoNotUseOrYouWillBeFired=Pe;const Se=D;function Te(e){const{buttonText:n,buttonType:o="link",danger:t,confirmTitle:a,onConfirm:f,loading:p,disabled:i,size:m="small",permissionKey:d,description:u}=e;return r.jsx(r.Fragment,{children:r.jsx(Se,{title:a,onConfirm:f,okText:"确认",cancelText:"取消",description:u,children:r.jsx(me,{permissionKey:d,disabled:i,loading:p,size:m,type:o,danger:t,children:n})})})}function be(e){const{permissions:n,children:o}=e,t=$(a=>a.menuRedux.permissionsList);return r.jsx(F,{className:n?te(t,n)?"mb-3":"":"mb-3",children:o})}function Ee(e){const{modalType:n,handleItem:o,reFresh:t,closeModal:a}=e,f=$(u=>u.user.token),[p,i]=s.useState([]);function m(u){E(0,i),O({url:oe,token:f,data:u}).then(y=>{y.code===200&&(t(),a())}).finally(()=>{j(0,i)})}function d(u){E(0,i),O({url:ae,token:f,data:{...u,id:o.id}}).then(y=>{y.code===200&&(t(),a())}).finally(()=>{j(0,i)})}return r.jsx(r.Fragment,{children:r.jsx(ne,{initialValues:o||void 0,fields:[{type:"input",required:!0,rules:[{required:!0,message:"请输入模版标题"}],name:"title",label:"模版标题",placeholder:"请输入模版标题"},{type:"textArea",required:!0,rules:[{required:!0,message:"请输入模版内容"}],name:"text",rows:3,label:"模版内容",placeholder:"请输入模版内容"}],showOk:!0,showCancel:!0,footerStyle:"end",okLoading:p[0],onFinish:n==="add"?m:d,onCancel:a})})}function ke(){const[e,n]=s.useState(),o=$(l=>l.user.token),[t,a]=s.useState([]),{key:f,refresh:p}=ue(),[i,m]=s.useState(""),[d,u]=s.useState(!1),[y,P]=s.useState();function v(){u(!0)}function S(){P(null),u(!1)}const T=[{title:"模版标题",width:160,dataIndex:"title",key:"title",fixed:"left",render:l=>l||"-"},{title:"模版内容",width:280,dataIndex:"text",key:"text",render:l=>l||"-"},{title:"更新时间",width:200,dataIndex:"time",key:"time",render:l=>r.jsx(ge,{text:l})},{title:"状态",width:120,dataIndex:"state",key:"state",render:(l,g)=>r.jsx(re,{checked:l==="启用",checkedChildren:"启用",unCheckedChildren:"禁用",loading:t[`state-${g.id}`],onChange:b=>{C(b,g.id)}})},{title:"操作",fixed:"right",width:160,render:(l,g)=>r.jsxs(F,{size:"middle",children:[r.jsx(w,{size:"small",type:"link",onClick:()=>{m("edit"),v(),P(g)},children:"编辑"}),r.jsx(Te,{confirmTitle:"是否确认删除？",buttonText:"删除",danger:!0,loading:t[g.id],onConfirm:()=>{h(g.id)}})]})}];function h(l){E(l,a),O({url:ie,token:o,data:N({id:l})}).then(g=>{g&&p()}).finally(()=>{j(l,a)})}function C(l,g){E(`state-${g}`,a),O({url:ce,token:o,data:N({id:g,state:l===!0?"启用":"禁用"})}).then(b=>{b&&p()}).finally(()=>{j(`status-${g}`,a)})}return r.jsxs(r.Fragment,{children:[r.jsx(pe,{fields:[{type:"input",placeholder:"标题",name:"title"},{type:"input",placeholder:"模版内容",name:"text"}],onFinish:n,rows:1}),r.jsx(be,{children:r.jsx(w,{onClick:()=>{m("add"),v()},type:"primary",children:"新增模版"})}),r.jsx(fe,{tableKey:f,columns:T,params:{searchParams:e},getListUrl:se,dataKey:"content"}),r.jsx(le,{open:d,title:i==="add"?"新增模版":i==="edit"?"编辑模版":"",centered:!0,onCancel:S,footer:null,destroyOnClose:!0,children:r.jsx(Ee,{modalType:i,handleItem:y,closeModal:S,reFresh:p})})]})}export{ke as default};
