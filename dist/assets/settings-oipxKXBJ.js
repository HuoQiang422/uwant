import{a as c,b as y,m as S,n as g,r as u,c as b,j as p,M as w,e as h,l as f,p as x,A as q,d as I}from"./index-y6A3uTe8.js";const k=async(n,t,a,s)=>{try{a&&(t.headers={...t.headers,Authorization:`${a}`}),t.signal=c.signal,s&&(t.responseType=s);const e=await y(n,t),l=e.headers["content-type"];if(e.status!==200)return null;const d=e.data.code||e.data.errorCode,i=typeof e.data.content=="string"&&e.data.content.trim()!==""?e.data.content:e.data.msg||e.data.message||e.data.errorMessage||e.data.errorMessge||e.data.errorMsg;if(d===401){S.error(i),localStorage.clear(),await c.abort(),g(),setTimeout(()=>{window.location.href="/login"},1e3);return}if(l.includes("application/json")||l.includes("text/plain")){if(d!==200)throw i||null;return e.data}else return e}catch(e){throw e}},C=n=>{const{url:t,data:a,token:s,responseType:e}=n;return k(t,{data:a,method:"POST"},s,e)};function A(){const[n,t]=u.useState([]),a=b(r=>r.user.token),[s,e]=u.useState(),[l,d]=u.useState("");function i(){h(1,t),C({url:I,token:a}).then(r=>{if(r){const o=r.content;o.isSend&&o.isSend==="是"?o.isSend=!0:o.isSend=!1,e(o),d(o.id)}}).finally(()=>{f(1,t)})}u.useEffect(()=>{i()},[]);function m(r){h(0,t),x({url:q,token:a,data:{...r,id:l}}).finally(()=>{f(0,t)})}return p.jsx("div",{style:{margin:"20px"},children:p.jsx(w,{labelWidth:120,initialValues:s,fields:[{type:"input",name:"tenantId",label:"租户ID",required:!0,placeholder:"请输入租户ID"},{type:"input",name:"secret",label:"秘钥",required:!0,placeholder:"请输入秘钥"},{type:"input",name:"tokenUrl",label:"三方接口地址",required:!0,placeholder:"请输入三方接口获取tokenURL地址"},{type:"input",name:"sendUrl",label:"短信发送接口",required:!0,placeholder:"请输入发送短信接口"},{type:"input",name:"overageUrl",label:"余额查询地址",required:!0,placeholder:"请输入余额查询地址"},{type:"input",name:"username",label:"短信平台账号",required:!0,placeholder:"请输入短信平台账号"},{type:"input",name:"password",label:"短信平台密码",required:!0,placeholder:"请输入短信平台密码"},{type:"input",name:"userId",label:"短信平台企业ID",required:!0,placeholder:"请输入短信平台企业ID"},{type:"input",name:"whUrl",label:"问卷地址",required:!0,placeholder:"请输入问卷地址"},{type:"switch",required:!0,name:"isSend",label:"开启短信发送",checkedText:"开启",uncheckedText:"关闭"}],showOk:!0,okText:"保存配置",okLoading:n[1]||n[0],footerButtonStyle:"full",footerDirection:"vertical",onFinish:r=>{r.isSend===!1?r.isSend="否":r.isSend="是",m(r)}},l)})}export{A as default};
