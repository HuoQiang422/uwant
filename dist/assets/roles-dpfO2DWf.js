import{r,u as k,j as e,a5 as f,a7 as _,S as I,a9 as R,e as j,p as S,ak as F,l as g,al as O,am as K,b as L,aj as A,ah as N,an as V,ao as B,ap as z,aq as q,ac as v,ad as G,ar as H,as as J,at as U}from"./index--DjN_GCZ.js";import{B as E,C,T as P}from"./confirm-rrV5STMe.js";import{T as Q}from"./index-eC0_A1iY.js";import{M as W}from"./myTable-gM2PRUcz.js";import"./useIcons-jgRnfhFH.js";function X(y){const{closeModal:l,initValues:h,modalType:c,freshData:a}=y,[m,o]=r.useState([]),i=k(n=>n.user.token);function u(n){j(0,o),S({url:F,token:i,data:n}).then(t=>{t&&(l(),a())}).finally(()=>{g(0,o)})}function d(n){j(0,o),S({url:O,token:i,data:{...n,roleId:h.roleId}}).then(t=>{t&&(l(),a())}).finally(()=>{g(0,o)})}return e.jsx(e.Fragment,{children:e.jsxs(f,{name:"role-form",labelCol:{flex:"82px"},initialValues:h||null,onFinish:c==="edit"?d:u,children:[e.jsx(f.Item,{required:!0,label:"角色名称",name:"name",rules:[{required:!0,message:"请输入角色名称"}],children:e.jsx(_,{placeholder:"请输入角色名称",allowClear:!0})}),e.jsx(f.Item,{label:"角色描述",name:"description",children:e.jsx(_,{placeholder:"请输入角色描述",allowClear:!0})}),e.jsxs(I,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(R,{onClick:l,children:"取消"}),e.jsx(R,{type:"primary",htmlType:"submit",loading:m[0],children:c==="edit"?"更新":"添加"})]})]})})}function Y(y){const[l]=f.useForm(),{closeModal:h,initValues:c}=y,[a,m]=r.useState([]),[o,i]=r.useState([]),u=k(t=>t.user.token);function d(){j(1,m),S({url:K,data:L({roleId:c.roleId}),token:u}).then(t=>{const p=A(N(t.content),"permissionId");i(p),l.setFieldValue("permissionIdS",A(V(t.content),"permissionId"))}).finally(()=>{g(1,m)})}function n(t){j(0,m);const p=B(t.permissionIdS);S({url:z,data:{permissionIdS:p,roleId:c.roleId},token:u}).then(()=>{h()}).finally(()=>{g(0,m)})}return r.useEffect(()=>{d()},[]),e.jsx(e.Fragment,{children:e.jsxs(f,{form:l,name:"role-permission",onFinish:n,disabled:a[0],children:[e.jsx(f.Item,{name:"permissionIdS",className:"mb-3",children:e.jsx(Q,{disabled:a[1],loading:a[1],multiple:!0,showSearch:!0,treeCheckable:!0,treeData:o,treeDefaultExpandAll:!0,treeCheckStrictly:!0,treeNodeFilterProp:"title",placeholder:a[1]?"加载中...":"请选择您要分配的权限"})}),e.jsx(I,{wrap:!0,className:"w-full justify-end",children:e.jsx(R,{type:"primary",htmlType:"submit",loading:a[0],children:"保存分配"})})]})})}function ae(){const[y,l]=r.useState(0),[h,c]=r.useState([]),a=k(s=>s.user.token),[m,o]=r.useState(!1),[i,u]=r.useState(),[d,n]=r.useState(),[t,p]=r.useState([]);function T(){o(!0)}function b(){G(),n(void 0),o(!1)}const D=[{title:"角色名称",width:160,dataIndex:"name",key:"name",fixed:"left",render:s=>s||"-"},{title:"状态",width:100,dataIndex:"status",key:"status",render:s=>e.jsx(P,{color:s===0?"":"green",children:s===0?"禁用":"正常"})},{title:"描述",width:200,dataIndex:"description",key:"description",render:s=>s||"-"},{title:"操作",width:230,fixed:"right",render:(s,x)=>e.jsxs(I,{size:"middle",children:[e.jsx(E,{permissionKey:"role:edit",size:"small",type:"link",onClick:()=>{u("edit"),n(x),T()},children:"编辑"}),e.jsx(E,{permissionKey:"role:assignPerms",size:"small",type:"link",onClick:()=>{u("assign"),n(x),T()},children:"分配权限"}),e.jsx(C,{permissionKey:"role:delete",danger:!0,confirmTitle:"是否确认删除",buttonText:"删除",onConfirm:()=>{M(x.roleId)}})]})}];function M(s){H({url:J,data:{roleId:s},token:a}).then(x=>{x&&l(Math.random())})}function w(){j(1,c),S({url:U,token:a,data:L({roleIds:t})}).then(s=>{s&&l(Math.random())}).finally(()=>{g(1,c),p([])})}return e.jsxs(e.Fragment,{children:[e.jsxs(I,{className:"mb-3",children:[e.jsx(E,{permissionKey:"role:add",type:"primary",onClick:()=>{T(),u("add")},children:"添加角色"}),e.jsx(C,{permissionKey:"role:batchDelete",danger:!0,disabled:t.length===0,buttonText:"批量删除",confirmTitle:"是否确认删除",onConfirm:w,loading:h[1],buttonType:"primary",size:"middle"})]}),e.jsx(W,{permissionKey:"role:batchDelete",checked:!0,rowKey:"roleId",columns:D,url:q,selectedRowKeys:t,setSelectedRowKeys:p,tableKey:y}),e.jsx(v,{title:i==="edit"?"编辑角色":i==="assign"?e.jsxs(I,{children:["分配权限",e.jsxs(P,{color:"blue",className:"flex",children:["当前角色：",d==null?void 0:d.name]})]}):"新增角色",open:m,onCancel:b,centered:!0,footer:null,destroyOnClose:!0,children:i==="assign"?e.jsx(Y,{closeModal:b,initValues:d}):e.jsx(X,{closeModal:b,modalType:i,initValues:d,freshData:()=>{l(Math.random())}})})]})}export{ae as default};
